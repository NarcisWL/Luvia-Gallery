services:
  lumina-gallery:
    build: .
    image: promenarleng/luvia-gallery:latest
    container_name: luvia-gallery
    restart: unless-stopped
    ports:
      - "3000:3001"
    volumes:
      # Volumes: Map as many folders as you need
      # Example:
      - ./media:/media
      # - /mnt/external_drive:/mnt/ext

      # Persistence for configuration
      - ./data:/app/data

      # Persistence for generated thumbnails
      - ./cache:/app/cache
      # [NEW] GIT AUTH: Mount SSH keys for private repo updates
      # Setup: Create 'ssh' folder in project root, put your 'id_ed25519' private key there.
      # WE MOUNT TO /tmp/ssh_mount to avoid permission issues on Windows.
      # The update script will copy them to /root/.ssh and fix permissions.
      - ./ssh:/tmp/ssh_mount:ro
    environment:
      - NODE_ENV=production
      # [MULTI-ROOT SUPPORT] Separate paths with ';' (semicolon)
      # Example: MEDIA_ROOT=/media;/mnt/ext
      - MEDIA_ROOT=/media
      # [SECURITY] Set this to enable password protection for the Update API.
      # If provided, the web UI will prompt for this token when you click Update.
      # - UPDATE_TOKEN=change_this_to_a_secret_string
      # - GIT_TOKEN=ghp_xxxx  # Alternative: Use Token instead of SSH
      # GPU Support: Set these if using NVIDIA GPU
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # Hardware Acceleration Configuration
    # NVIDIA GPU Support enabled for Fnos/Linux hosts
    privileged: true
    runtime: nvidia
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    # For Intel/AMD VAAPI (Linux/WSL2), uncomment:
    # devices:
    #   - /dev/dri:/dev/dri
