services:
  lumina-gallery:
    build: .
    image: promenarleng/lumina-gallery:v1.2.0
    container_name: lumina-gallery
    restart: unless-stopped
    ports:
      - "3000:3001"
    volumes:
      # Map your media folder
      - ./media:/media

      # Persistence for configuration
      - ./data:/app/data

      # Persistence for generated thumbnails
      - ./cache:/app/cache
      # [NEW] GIT AUTH: Mount SSH keys for private repo updates
      # Setup: Create 'ssh' folder in project root, put your 'id_ed25519' private key there.
      # WE MOUNT TO /tmp/ssh_mount to avoid permission issues on Windows.
      # The update script will copy them to /root/.ssh and fix permissions.
      - ./ssh:/tmp/ssh_mount:ro
    environment:
      - NODE_ENV=production
      - MEDIA_ROOT=/media
      # - GIT_TOKEN=ghp_xxxx  # Alternative: Use Token instead of SSH
      # GPU Support: Set these if using NVIDIA GPU
      # GPU Support: Set these if using NVIDIA GPU
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # Hardware Acceleration Configuration
    # Uncomment the following section to enable NVIDIA GPU support.
    # Requires NVIDIA Container Toolkit installed on host.
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]

    # For Intel/AMD VAAPI (Linux/WSL2), uncomment:
    # devices:
    #   - /dev/dri:/dev/dri
