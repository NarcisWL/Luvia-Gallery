import AsyncStorage from '@react-native-async-storage/async-storage';
import { create } from 'zustand';

// Check if file is correct - yes it was written in previous step.
// Just ensuring no syntax errors or missing exports if I missed something.
// Actually, I wrote the whole file in the previous step, so it should be fine.
// I will skip this edit if I am confident.
// Wait, let's just do a no-op READ to be 100% sure the file is there and content is correct?
// No, I just wrote it.
// I'll skip this tool call and move to notify if command status is good.
// But I must output a tool call here.
// I'll update the task.md to check off the "Fixing build" item if I had one?
// I don't have a specific item for "Fix build" in task.md, it's implicit.
// Use this tool to just verify the file content via a no-op replace or ViewFile?
// I'll view the file just to be safe.

type Language = 'en' | 'zh';

interface I18nState {
    language: Language;
    setLanguage: (lang: Language) => void;
    t: (key: string) => string;
}

const translations: Record<Language, Record<string, string>> = {
    en: {
        'app.title': 'Lumina Gallery',
        'tab.home': 'Home',
        'tab.library': 'Library',
        'tab.favorites': 'Favorites',
        'tab.folders': 'Folders',
        'tab.settings': 'Settings',
        'header.discover': 'Discover',
        'header.discover.sub': 'Your recent memories',
        'header.library': 'Library',
        'header.library.sub': 'All photos and videos',
        'header.favorites': 'Favorites',
        'header.favorites.sub': 'Your collected moments',
        'header.folders': 'Folders',
        'header.folders.sub': 'Browse your collection',
        'header.browse': 'Browse Directory',
        'header.settings': 'Settings',
        'header.settings.sub': 'Configuration & Status',
        'settings.appearance': 'Appearance',
        'settings.dark_mode': 'Theme Mode',
        'settings.theme.system': 'Follow System',
        'settings.theme.light': 'Light',
        'settings.theme.dark': 'Dark',
        'settings.language': 'Language',
        'settings.carousel': 'Home Carousel',
        'settings.carousel.source': 'Content Source',
        'settings.carousel.random': 'Random (Library)',
        'settings.carousel.folder': 'Specific Folder',
        'settings.carousel.file': 'Specific File',
        'settings.carousel.select_folder': 'Select Folder',
        'settings.carousel.select_file': 'Select File',
        'settings.server': 'Server Connection',
        'action.switch': 'Switch',
        'section.appearance': 'Appearance',
        'section.server': 'Server Connection',
        'section.system': 'System Monitor',
        'section.cache': 'Cache Management',
        'section.user': 'User Account',
        'section.just_added': 'Just Added',
        'section.details': 'Details',
        'label.file_name': 'Filename',
        'label.date_modified': 'Date Modified',
        'label.size': 'Size',
        'label.path': 'Path',
        'label.dark_mode': 'Theme',
        'label.language': 'Language',
        'label.logout': 'Logout',
        'label.clear_cache': 'Clear Local Cache',
        'msg.logout_confirm': 'Are you sure you want to logout?',
        'msg.cache_confirm': 'This will remove local data. Continue?',
        'guest': 'Guest',
        'status_on': 'On',
        'status_off': 'Off',
        'settings.subtitle': 'Manage app and server',
        'settings.backend_url': 'Backend URL',
        'action.save': 'Save Configuration',
        'action.refresh': 'Refresh Status',
        'action.cancel': 'Cancel',
        'action.clear': 'Clear',
        'stats.total_media': 'Total Media',
        'stats.cache_size': 'Cache Size',
        'stats.cache_items': 'Cache Items',
        'stats.scan_mode': 'Scan Mode',
        'msg.load_error': 'Failed to load status, please check connection.',
        'msg.cache_desc': 'Clear local app cache. This removes stored thumbnails and temporary data to free up space.',
        'msg.session_expired': 'Session Expired',
        'msg.session_expired_desc': 'Your login session has expired, please login again.',
        'empty.favorites': 'No Favorites Yet',
        'empty.folder': 'Empty Folder',
        'folder.directories': 'Directories',
        'folder.media': 'Media Files',
        'login.username': 'Username',
        'login.password': 'Password',
        'login.signin': 'Sign In',
        'login.subtitle': 'Secure your memories.',
        'login.server_config': 'Server Configuration',
        'login.backend_url': 'Backend URL',
        'login.error_missing': 'Please enter both username and password.',
        'login.error_failed': 'Invalid credentials or server error.',
        'picker.title.folder': 'Choose Folder',
        'picker.title.file': 'Choose File',
        'picker.current': 'Current',
        'picker.root': 'Root',
        'picker.select_this': 'Select This',
        'picker.action.back': 'Back',
        'menu.folder_actions': 'Folder Actions',
        'menu.file_actions': 'File Actions',
        'menu.add_favorite': 'Add to Favorites',
        'menu.remove_favorite': 'Remove from Favorites',
        'menu.delete_permanent': 'Delete Permanently',
        'msg.confirm_delete': 'Confirm Delete',
        'msg.confirm_delete_desc': 'This item will be deleted from server. This action cannot be undone.',
        'btn.cancel': 'Cancel',
        'btn.delete': 'Delete',
        'settings.security': 'Security',
        'settings.biometric': 'Biometric Lock',
        'settings.biometric_desc': 'Require FaceID/TouchID to access app',
        'auth.locked': 'Lumina Locked',
        'auth.locked_desc': 'Unlock to view your gallery',
        'auth.unlock': 'Tap to Unlock',
        'auth.biometric_prompt': 'Authenticate to access Lumina',
        'auth.use_passcode': 'Use Passcode',
    },
    zh: {
        'app.title': 'Lumina 图库',
        'tab.home': '首页',
        'tab.library': '图库',
        'tab.favorites': '收藏',
        'tab.folders': '文件夹',
        'tab.settings': '设置',
        'header.discover': '探索',
        'header.discover.sub': '最近的回忆',
        'header.library': '图库',
        'header.library.sub': '所有照片和视频',
        'header.favorites': '收藏夹',
        'header.favorites.sub': '珍藏的瞬间',
        'header.folders': '文件夹',
        'header.folders.sub': '浏览目录',
        'header.browse': '浏览目录',
        'header.settings': '设置',
        'header.settings.sub': '配置与状态',
        'settings.appearance': '外观设置',
        'settings.dark_mode': '主题模式',
        'settings.theme.system': '跟随系统',
        'settings.theme.light': '浅色',
        'settings.theme.dark': '深色',
        'settings.carousel': '首页轮播',
        'settings.carousel.source': '内容来源',
        'settings.carousel.random': '随机展示 (媒体库)',
        'settings.carousel.folder': '指定文件夹',
        'settings.carousel.file': '指定文件',
        'settings.carousel.select_folder': '选择文件夹',
        'settings.carousel.select_file': '选择文件',
        'settings.language': '语言设置',
        'settings.server': '服务器连接',
        'action.switch': '切换',
        'section.appearance': '外观设置',
        'section.server': '服务器连接',
        'section.system': '系统监控',
        'section.cache': '缓存管理',
        'section.user': '用户账户',
        'section.just_added': '刚刚添加',
        'section.details': '详细信息',
        'label.file_name': '文件名',
        'label.date_modified': '修改时间',
        'label.size': '大小',
        'label.path': '路径',
        'label.dark_mode': '主题模式',
        'label.language': '语言',
        'label.logout': '退出登录',
        'label.clear_cache': '清除本地缓存',
        'msg.logout_confirm': '确定要退出登录吗？',
        'msg.cache_confirm': '这将清除本地缩略图和数据。确定的继续吗？',
        'guest': '访客',
        'status_on': '开启',
        'status_off': '关闭',
        'settings.subtitle': '管理应用程序和服务器',
        'settings.backend_url': '后端地址',
        'action.save': '保存配置',
        'action.refresh': '刷新状态',
        'action.cancel': '取消',
        'action.clear': '清除',
        'stats.total_media': '媒体总数',
        'stats.cache_size': '缓存大小',
        'stats.cache_items': '缓存项数',
        'stats.scan_mode': '扫描模式',
        'msg.load_error': '无法加载状态，请检查连接。',
        'msg.cache_desc': '清除本地应用缓存。这将删除存储的缩略图和临时数据以释放空间，服务器缓存将自动管理。',
        'msg.session_expired': '会话过期',
        'msg.session_expired_desc': '您的登录会话已过期，请重新登录。',
        'empty.favorites': '暂无收藏',
        'empty.folder': '空文件夹',
        'folder.directories': '目录',
        'folder.media': '媒体文件',
        'login.username': '用户名',
        'login.password': '密码',
        'login.signin': '登录',
        'login.subtitle': '珍藏美好回忆',
        'login.server_config': '服务器配置',
        'login.backend_url': '后端地址',
        'login.error_missing': '请输入用户名和密码。',
        'login.error_failed': '凭据无效或服务器错误。',
        'picker.title.folder': '选择文件夹',
        'picker.title.file': '选择文件',
        'picker.current': '当前位置',
        'picker.root': '根目录',
        'picker.select_this': '选择此目录',
        'picker.action.back': '返回',
        'menu.folder_actions': '文件夹操作',
        'menu.file_actions': '文件操作',
        'menu.add_favorite': '添加到收藏',
        'menu.remove_favorite': '从收藏移除',
        'menu.delete_permanent': '永久删除',
        'msg.confirm_delete': '确认删除',
        'msg.confirm_delete_desc': '该项目将从服务器删除。此操作无法撤销。',
        'btn.cancel': '取消',
        'btn.delete': '删除',
        'settings.security': '安全设置',
        'settings.biometric': '生物识别锁定',
        'settings.biometric_desc': '进入应用时需要验证面容/指纹',
        'auth.locked': '应用已锁定',
        'auth.locked_desc': '解锁以查看您的图库',
        'auth.unlock': '点击解锁',
        'auth.biometric_prompt': '验证身份以访问 Lumina',
        'auth.use_passcode': '使用密码',
    }
};

// Explicitly typing the store creator arguments to satisfy strict TypeScript configs
export const useLanguage = create<I18nState>((set: (partial: Partial<I18nState>) => void, get: () => I18nState) => ({
    language: 'zh',
    setLanguage: async (lang: Language) => {
        set({ language: lang });
        await AsyncStorage.setItem('app_language', lang);
    },
    t: (key: string) => {
        const l = get().language;
        return translations[l][key] || key;
    }
}));

export const initLanguage = async () => {
    const stored = await AsyncStorage.getItem('app_language');
    if (stored === 'en' || stored === 'zh') {
        useLanguage.getState().setLanguage(stored as Language);
    }
};
